

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>GridAPPS-D Application Structure &mdash; GridAPPS-D 2021_05.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="GridAPPS-D Service Structure" href="2.5--Lesson-2.5--GridAPPS-D-Service-Structure.html" />
    <link rel="prev" title="GridAPPS-D Python Library" href="2.3--Lesson-2.3--GridAPPS-D-Python-Library.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> GridAPPS-D
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation &amp; Runtime</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation/windows10/index.html">Windows 10 Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/1.4--Lesson-1.4--Running-GridAPPS-D.html">Running GridAPPS-D</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/1.5--Lesson-1.5--Using-GridAPPS-D-Viz.html">Using the GridAPPS-D Viz</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/1.6--Lesson-1.6--Docker-Shortcuts.html">Docker Shortcuts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/1.7--Lesson-1.7--Cloud-Server-Configuration.html">Cloud Server Configuration</a></li>
</ul>
<p class="caption"><span class="caption-text">GridAPPS-D Overview</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="2.1--Lesson-2.1--Intro-to-GridAPPS-D.html">GridAPPS-D Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="2.2--Lesson-2.2--GridAPPS-D-Architecture.html">GridAPPS-D Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="2.3--Lesson-2.3--GridAPPS-D-Python-Library.html">GridAPPS-D Python Library</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">GridAPPS-D Application Structure</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Application-Structure">Application Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Connecting-to-GridAPPS-D-Platform">Connecting to GridAPPS-D Platform</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Querying-for-the-Power-System-Model">Querying for the Power System Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Model-Query-Information-flow">Model Query Information flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Model-Query-Sample-App-code">Model Query Sample App code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Querying-for-Measurement-mRIDs">Querying for Measurement mRIDs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Measurement-Query-Information-Flow">Measurement Query Information Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Measurement-Query-Sample-App-Code">Measurement Query Sample App Code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Querying-for-Weather-Data">Querying for Weather Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Weather-Query-Information-Flow">Weather Query Information Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Weather-Query-Sample-App-Code">Weather Query Sample App Code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Configuring-a-Parallel-Simulation">Configuring a Parallel Simulation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Configuration-Query-Information-Flow">Configuration Query Information Flow</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#5.2.-Sample-App-Code">5.2. Sample App Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Configuration-Query-Sample-App-Code">Configuration Query Sample App Code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Processing-Measurements-&amp;-App-Core-Algorithm">Processing Measurements &amp; App Core Algorithm</a></li>
<li class="toctree-l2"><a class="reference internal" href="#6.1-Information-Flow">6.1 Information Flow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#App-Core-Information-Flow">App Core Information Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#6.2.-Sample-App-Code">6.2. Sample App Code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#7.-Subscribing-to-Simulation-Output">7. Subscribing to Simulation Output</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#7.1.-Information-Flow">7.1. Information Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#7.2.-Sample-App-Code">7.2. Sample App Code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#8.-Publishing-Equipment-Commands">8. Publishing Equipment Commands</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#8.1.-Information-Flow">8.1. Information Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#8.2.-Sample-App-Code">8.2. Sample App Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="#8.3.-Viewing-Application-Results-in-GridAPPS-D-Viz">8.3. Viewing Application Results in GridAPPS-D Viz</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#9.-Querying-Historical-&amp;-Timeseries-Data">9. Querying Historical &amp; Timeseries Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#9.1.-Information-Flow">9.1. Information Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#9.2.-Sample-App-Code">9.2. Sample App Code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#10.-Subscribing-and-Publishing-to-Logs">10. Subscribing and Publishing to Logs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#10.1.-Information-Flow-Diagram">10.1. Information Flow Diagram</a></li>
<li class="toctree-l3"><a class="reference internal" href="#10.2-Sample-App-Code">10.2 Sample App Code</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="2.5--Lesson-2.5--GridAPPS-D-Service-Structure.html">GridAPPS-D Service Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="2.6--Lesson-2.6--Common-Information-Model.html">Introduction to the Common Information Model</a></li>
</ul>
<p class="caption"><span class="caption-text">GridAPPS-D API Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api_usage/3.1--Lesson-3.1--API-Communication-Channels.html">API Communication Channels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_usage/3.2--Lesson-3.2--API-Message-Structure.html">API Message Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_usage/3.3--Lesson-3.3--Using-the-PowerGrid-Models-API.html">Using the PowerGrid Models API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_usage/3.4--Lesson-3.4--Using-the-Configuration-File-API.html">Using the Configuration File API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_usage/3.5--Lesson-3.5--Creating-Running-Simulation-API.html">Running Simulations with the Simulation API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_usage/3.6--Lesson-3.6--Controlling-Simulation-API.html">Publishing and Subscribing with the Simulation API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_usage/3.7--Lesson-3.7--Using-the-Timeseries-API.html">Timeseries API</a></li>
</ul>
<p class="caption"><span class="caption-text">GridAPPS-D Applications</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../applications/restoration-WSU/source/index.html">Resilient Restoration (WSU)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/VVO-WSU/README.html">Volt-Var Optimization (WSU)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/DER-dispatch-NREL/README.html">DER Dispatch (NREL)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/solar-forecast-NREL/README.html">Solar Forecasting (NREL)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/grid-forecast-NREL/README.html">Grid Forecasting (NREL)</a></li>
</ul>
<p class="caption"><span class="caption-text">GridAPPS-D Services</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../services/dnp3/source/index.html">GridAPPS-D DNP3 Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services/sensor-simulator/source/index.html">GridAPPS-D Sensor Simulator Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services/voltage-violation/README.html">GridAPPS-D Voltage Violation Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services/state-estimator/README.html">GridAPPS-D State Estimator Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services/alarms/README.html">GridAPPS-D Alarm Service</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GridAPPS-D</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>GridAPPS-D Application Structure</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/overview/2.4--Lesson-2.4--GridAPPS-D-Application-Structure.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<hr class="docutils" />
<div class="section" id="GridAPPS-D-Application-Structure">
<h1>GridAPPS-D Application Structure<a class="headerlink" href="#GridAPPS-D-Application-Structure" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<div class="section" id="Application-Structure">
<h2>Application Structure<a class="headerlink" href="#Application-Structure" title="Permalink to this headline">¶</a></h2>
<p>The structure of a GridAPPS-D application can be broken into nine sections:</p>
<ul class="simple">
<li><p>Querying for the power system model</p></li>
<li><p>Querying for measurement MRIDs</p></li>
<li><p>Querying for weather data (if needed)</p></li>
<li><p>Configuring parallel simulations (if needed)</p></li>
<li><p>App core algorithm &amp; measurement processing</p></li>
<li><p>Subscribing to simulation output</p></li>
<li><p>Publishing equipment commands</p></li>
<li><p>Querying historical &amp; timeseries data</p></li>
<li><p>Subscribing and publishing to logs</p></li>
</ul>
<p>Each of these task sections within an application are explained below with sample code that can interact with a simulation running on the GridAPPS-D platform.</p>
</div>
<div class="section" id="Connecting-to-GridAPPS-D-Platform">
<h2>Connecting to GridAPPS-D Platform<a class="headerlink" href="#Connecting-to-GridAPPS-D-Platform" title="Permalink to this headline">¶</a></h2>
<p>Prior to running any of the API calls or other core application code, the application needs to establish a secure connection with the GridAPPS-D platform.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Import GridAPPSD-Python Library:</span>
<span class="kn">from</span> <span class="nn">gridappsd</span> <span class="kn">import</span> <span class="n">GridAPPSD</span>

<span class="c1"># When developing locally, paste Simulation ID into this variable</span>
<span class="c1"># When running inside docker, this is passed automatically by platform</span>
<span class="n">viz_simulation_id</span> <span class="o">=</span> <span class="s2">&quot;1093527122&quot;</span>

<span class="c1"># Simulation running on IEEE 123 node model:</span>
<span class="n">model_mrid</span> <span class="o">=</span> <span class="s2">&quot;_C1C3E687-6FFD-C753-582B-632A27E28507&quot;</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Set environment variables - when developing, put environment variable in ~/.bashrc file or export in command line</span>
<span class="c1"># export GRIDAPPSD_USER=system</span>
<span class="c1"># export GRIDAPPSD_PASS=manager</span>

<span class="kn">import</span> <span class="nn">os</span> <span class="c1"># Set username a</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;GRIDAPPSD_USER&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;tutorial_user&#39;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;GRIDAPPSD_PASS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;12345!&#39;</span>

<span class="c1"># Connect to GridAPPS-D Platform</span>
<span class="n">gapps</span> <span class="o">=</span> <span class="n">GridAPPSD</span><span class="p">(</span><span class="n">viz_simulation_id</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">gapps</span><span class="o">.</span><span class="n">connected</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
</div>
<div class="section" id="Querying-for-the-Power-System-Model">
<h2>Querying for the Power System Model<a class="headerlink" href="#Querying-for-the-Power-System-Model" title="Permalink to this headline">¶</a></h2>
<p>The first portion of a GridAPPS-D application is series of queries to the PowerGrid Models API to obtain information about the power system model.</p>
<p>Because GridAPPS-D applications are designed to be portable across numerous power system models without any code modification, the application must query the Blazegraph database and create a set of local variables that contain the information needed by the app to run its internal code.</p>
<p>An application will query for the various pieces of power system equipment relevant to its objective (e.g. a VVO app will be interested in regulators and capacitors, while a FLISR app will be interested in switches and reclosers present in the model). The query will typically include requests for information about the names, location, mRIDS, and electrical parameters for the various pieces of equipment needed by the application..</p>
<div class="section" id="Model-Query-Information-flow">
<h3>Model Query Information flow<a class="headerlink" href="#Model-Query-Information-flow" title="Permalink to this headline">¶</a></h3>
<p>The figure below shows the information flow involved in making a query for the power system model.</p>
<p>The query is sent using <code class="docutils literal notranslate"><span class="pre">gapps.get_response(topic,</span> <span class="pre">message)</span></code> on a queue channel (explained in <a class="reference internal" href="../api_usage/3.1--Lesson-3.1--API-Communication-Channels.html"><span class="doc">API Communication Channels</span></a>) with a response expected back from the platform within the specified timeout period.</p>
<p><img alt="Query-for-power-system-model" src="../_images/01_query_model.png" /></p>
<p><strong>Application passes query to GridAPPS-D Platform</strong></p>
<p>First, the application creates a query message for requesting information about the desired power system components in the format of a JSON string or equivalant Python dictionary object. The syntax of this message is explained in detail in <a class="reference internal" href="../api_usage/3.3--Lesson-3.3--Using-the-PowerGrid-Models-API.html"><span class="doc">Using the PowerGrid Models API</span></a>.</p>
<p>The application then passes the query through the PowerGrid Models API to the GridAPPS-D Platform, which publishes it to a queue channel on the GOSS Message Bus. If the app is authenticated and authorized to pass queries, the query message is delivered to the data managers, which obtain the desired information from the Blazegraph Database.</p>
<p><strong>GridAPPS-D Platform responds to Application query</strong></p>
<p>The data managers then publish the response from the Blazegraph Database to the appropriate queue channel. The PowerGrid Models API then returns the desired information back to the application as a JSON message or equivalant Python dictionary object.</p>
<hr class="docutils" />
</div>
<div class="section" id="Model-Query-Sample-App-code">
<h3>Model Query Sample App code<a class="headerlink" href="#Model-Query-Sample-App-code" title="Permalink to this headline">¶</a></h3>
<p>Below is a sample query of how the application will use the PowerGrid Models API to query for the details associated for all the switches in the feeder.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">gridappsd</span> <span class="kn">import</span> <span class="n">topics</span> <span class="k">as</span> <span class="n">t</span>

<span class="n">message</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;modelId&quot;</span><span class="p">:</span> <span class="n">model_mrid</span><span class="p">,</span>
    <span class="s2">&quot;requestType&quot;</span><span class="p">:</span> <span class="s2">&quot;QUERY_OBJECT_DICT&quot;</span><span class="p">,</span>
    <span class="s2">&quot;resultFormat&quot;</span><span class="p">:</span> <span class="s2">&quot;JSON&quot;</span><span class="p">,</span>
    <span class="s2">&quot;objectType&quot;</span><span class="p">:</span> <span class="s2">&quot;LoadBreakSwitch&quot;</span>
<span class="p">}</span>

<span class="n">response_obj</span> <span class="o">=</span> <span class="n">gapps</span><span class="o">.</span><span class="n">get_response</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">REQUEST_POWERGRID_DATA</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
<span class="n">switch_dict</span> <span class="o">=</span> <span class="n">response_obj</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>

<span class="c1"># Filter to get mRID for switch SW2:</span>
<span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">switch_dict</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">index</span><span class="p">[</span><span class="s2">&quot;IdentifiedObject.name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;sw2&#39;</span><span class="p">:</span>
        <span class="n">sw_mrid</span> <span class="o">=</span> <span class="n">index</span><span class="p">[</span><span class="s2">&quot;IdentifiedObject.mRID&quot;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">switch_dict</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># Print dictionary for first switch</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;mRID of sw2 is &#39;</span><span class="p">,</span><span class="n">sw_mrid</span><span class="p">)</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
</div>
</div>
<div class="section" id="Querying-for-Measurement-mRIDs">
<h2>Querying for Measurement mRIDs<a class="headerlink" href="#Querying-for-Measurement-mRIDs" title="Permalink to this headline">¶</a></h2>
<p>The next portion of a GridAPPS-D application is series of queries to the PowerGrid Models API to obtain information about the measurements associated with various pieces of equipment the application is interested in. Due to structure of the Common Information Model (introduced in <a class="reference internal" href="2.6--Lesson-2.6--Common-Information-Model.html"><span class="doc">Intro to Common Information Model</span></a>), there exist a separate set of objects associated with the positive-neutral-voltage (PNV), volt-ampere (VA), and
position measurements (POS) for each line, transformer, switch, etc.</p>
<p>Because GridAPPS-D applications are designed to be portable across numerous power system models without any code modification, the application must query the Blazegraph Database and create a set of local variables that contain the unique mRIDS of each measurement needed by the app to run its internal code. In a subsequent step, the app will use these measurement mRIDs to subscribe to the live streaming data issued by the simulation.</p>
<div class="section" id="Measurement-Query-Information-Flow">
<h3>Measurement Query Information Flow<a class="headerlink" href="#Measurement-Query-Information-Flow" title="Permalink to this headline">¶</a></h3>
<p>The figure below shows the information flow involved in making a query for the power system model.</p>
<p>The query is sent using <code class="docutils literal notranslate"><span class="pre">gapps.get_response(topic,</span> <span class="pre">message)</span></code> on a queue channel (explained in <a class="reference internal" href="../api_usage/3.1--Lesson-3.1--API-Communication-Channels.html"><span class="doc">API Communication Channels</span></a>) with a response expected back from the platform within the specified timeout period.</p>
<p><img alt="Query-for-model-MRIDs" src="../_images/02_query_model_mrids.png" /></p>
<p>The figure below shows the information flow involved in making a query for the power system model.</p>
<p><strong>Application passes query to GridAPPS-D Platform</strong></p>
<p>First, the application creates a query message for requesting information about the desired power system components in the format of a JSON string or equivalant Python dictionary object. The syntax of this message is explained in detail in <a class="reference internal" href="../api_usage/3.3--Lesson-3.3--Using-the-PowerGrid-Models-API.html"><span class="doc">Using PowerGrid Models API</span></a>.</p>
<p>The application then passes the query through the PowerGrid Models API to the GridAPPS-D Platform, which publishes it to a queue channel on the GOSS Message Bus. If the app is authenticated and authorized to pass queries, the query message is delivered to the data managers, which obtain the desired information from the Blazegraph Database.</p>
<p><strong>GridAPPS-D Platform responds to Application query</strong></p>
<p>The data managers then publish the response from the Blazegraph Database to the appropriate queue channel. The PowerGrid Models API then returns the desired information back to the application as a JSON message or equivalant Python dictionary object.</p>
<hr class="docutils" />
</div>
<div class="section" id="Measurement-Query-Sample-App-Code">
<h3>Measurement Query Sample App Code<a class="headerlink" href="#Measurement-Query-Sample-App-Code" title="Permalink to this headline">¶</a></h3>
<p>Below is a sample query of how the application will use the PowerGrid Models API to query for the measurement mRIDs of all switches in the power system model</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">message</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;modelId&quot;</span><span class="p">:</span> <span class="n">model_mrid</span><span class="p">,</span>
    <span class="s2">&quot;requestType&quot;</span><span class="p">:</span> <span class="s2">&quot;QUERY_OBJECT_MEASUREMENTS&quot;</span><span class="p">,</span>
    <span class="s2">&quot;resultFormat&quot;</span><span class="p">:</span> <span class="s2">&quot;JSON&quot;</span><span class="p">,</span>
    <span class="s2">&quot;objectType&quot;</span><span class="p">:</span> <span class="s2">&quot;LoadBreakSwitch&quot;</span>
<span class="p">}</span>

<span class="n">response_obj</span> <span class="o">=</span> <span class="n">gapps</span><span class="o">.</span><span class="n">get_response</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">REQUEST_POWERGRID_DATA</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span> <span class="c1"># Pass query to PowerGrid Models API</span>
<span class="n">measurements_obj</span> <span class="o">=</span> <span class="n">response_obj</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>

<span class="k">global</span> <span class="n">Pos_obj</span> <span class="c1"># Define global python dictionary of position measurements</span>
<span class="n">Pos_obj</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">measurements_obj</span> <span class="k">if</span> <span class="n">k</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Pos&#39;</span><span class="p">]</span> <span class="c1"># Filter measurements to just switch positions</span>

<span class="nb">print</span><span class="p">(</span><span class="n">Pos_obj</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># Print switch position measurement mRID for first switch</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
</div>
</div>
<div class="section" id="Querying-for-Weather-Data">
<h2>Querying for Weather Data<a class="headerlink" href="#Querying-for-Weather-Data" title="Permalink to this headline">¶</a></h2>
<p>The next portion of a GridAPPS-D application is series of queries to the Timeseries API to obtain information about the weather data for the current time, including irradiation, temperature, etc. This information can be used for solar forecasting, load forecasting, etc.</p>
<p>Because GridAPPS-D applications are designed to be portable across numerous power system models without any code modification, the application must query the Timeseries Influx Database and create a set of local variables that contain the weather data needed by the app to run its internal code.</p>
<div class="section" id="Weather-Query-Information-Flow">
<h3>Weather Query Information Flow<a class="headerlink" href="#Weather-Query-Information-Flow" title="Permalink to this headline">¶</a></h3>
<p>The figure below shows the information flow involved in making a query for the power system model.</p>
<p>The query is sent using <code class="docutils literal notranslate"><span class="pre">gapps.get_response(topic,</span> <span class="pre">message)</span></code> on the Timeseries queue channel (explained in <a class="reference internal" href="../api_usage/3.1--Lesson-3.1--API-Communication-Channels.html"><span class="doc">API Communication Channels</span></a>) with a response expected back from the platform within the specified timeout period.</p>
<p><img alt="Query-for-weather" src="../_images/03_query_weather.png" /></p>
<p><strong>Application passes query to GridAPPS-D Platform</strong></p>
<p>First, the application creates a query message for requesting information about the desired power system components in the format of a JSON string or equivalant Python dictionary object. The syntax of this message is explained in detail in <a class="reference internal" href="../api_usage/3.7--Lesson-3.7--Using-the-Timeseries-API.html"><span class="doc">Using the Timeseries API</span></a>.</p>
<p>The application then passes the query through the Timeseries API to the GridAPPS-D Platform, which publishes it to a queue channel on the GOSS Message Bus. If the app is authenticated and authorized to pass queries, the query message is delivered to the Data Managers, which obtain the desired information from the Timeseries Influx Database.</p>
<p><strong>GridAPPS-D Platform responds to Application query</strong></p>
<p>The Data Managers then publish the response from the Timeseries Influx Database to the appropriate queue channel. The Timeseries API then returns the desired information back to the application as a JSON message or equivalant Python dictionary object.</p>
<hr class="docutils" />
</div>
<div class="section" id="Weather-Query-Sample-App-Code">
<h3>Weather Query Sample App Code<a class="headerlink" href="#Weather-Query-Sample-App-Code" title="Permalink to this headline">¶</a></h3>
<p>Below is a sample query to the Timeseries API requesting all weather data between a certain startTime and endTime (given in unix absolute time). The application can then use that weather data to feed its internal forecasting algorithm.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Use queryFilter of &quot;startTime&quot; and &quot;endTime&quot;</span>
<span class="n">message</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;queryMeasurement&quot;</span><span class="p">:</span><span class="s2">&quot;weather&quot;</span><span class="p">,</span>
    <span class="s2">&quot;queryFilter&quot;</span><span class="p">:{</span><span class="s2">&quot;startTime&quot;</span><span class="p">:</span><span class="s2">&quot;1357048800000000&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;endTime&quot;</span><span class="p">:</span><span class="s2">&quot;1357048860000000&quot;</span><span class="p">},</span>
    <span class="s2">&quot;responseFormat&quot;</span><span class="p">:</span><span class="s2">&quot;JSON&quot;</span>
<span class="p">}</span>

<span class="n">response_obj</span> <span class="o">=</span> <span class="n">gapps</span><span class="o">.</span><span class="n">get_response</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">TIMESERIES</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span> <span class="c1"># Pass query to Timeseries API</span>
<span class="n">weather_obj</span> <span class="o">=</span> <span class="n">response_obj</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">weather_obj</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># Print first line of weather data</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
</div>
</div>
<div class="section" id="Configuring-a-Parallel-Simulation">
<h2>Configuring a Parallel Simulation<a class="headerlink" href="#Configuring-a-Parallel-Simulation" title="Permalink to this headline">¶</a></h2>
<p>Some applications may choose to run parallel simulations (similar to a digital twin), either within the GridAPPS-D platform or by exporting the model to OpenDSS, GridLAB-D, etc. This is accomplished through one or more queries to the Configuration File API to create a simulation configuration file and/or exported power system model.</p>
<p>The simulation configuration file contains all the necessary info to create a new simulation, including the power system model, date/time, and variations from the default basecase (i.e. re-dispatched DERs and switches that have been opened/closed).</p>
<p>The exported power system model is the entire model as a set of GLM or DSS that can be saved to an external file and then solved with a different power flow solver outside of the GridAPPS-D Platform.</p>
<div class="section" id="Configuration-Query-Information-Flow">
<h3>Configuration Query Information Flow<a class="headerlink" href="#Configuration-Query-Information-Flow" title="Permalink to this headline">¶</a></h3>
<p>The figure below shows the information flow involved in making a query for the power system model.</p>
<p>The query is sent using <code class="docutils literal notranslate"><span class="pre">gapps.get_response(topic,</span> <span class="pre">message)</span></code> on the Configuration File queue channel (explained in <a class="reference internal" href="../api_usage/3.1--Lesson-3.1--API-Communication-Channels.html"><span class="doc">API Communication Channels</span></a>) with a response expected back from the platform within the specified timeout period.</p>
<p><img alt="config-sim-export" src="../_images/04_config_sim_export1.png" /></p>
<p><strong>Application passes query to GridAPPS-D Platform</strong></p>
<p>First, the application creates a query message for requesting information about the desired power system configuration in the format of a JSON string or equivalant Python dictionary object. The syntax of this message is explained in detail in <a class="reference internal" href="../api_usage/3.4--Lesson-3.4--Using-the-Configuration-File-API.html"><span class="doc">Using the Configuration File API</span></a></p>
<p>The application then passes the query through the Configuration File API to the GridAPPS-D Platform, which publishes it to a queue channel on the GOSS Message Bus. If the app is authenticated and authorized to pass queries, the query message is delivered to the Configuration Manager.</p>
<p><strong>GridAPPS-D Platform responds to Application query</strong></p>
<p>The Configuration Manager obtains the CIM XML file for the desired power system model and then converts it to the desired output format with all of the requested changes to the model. The Configuration File API then returns the desired information back to the application as a JSON message (for Y-Bus or partial models) or export the files to the directory specified in the</p>
<hr class="docutils" />
</div>
</div>
<div class="section" id="5.2.-Sample-App-Code">
<h2>5.2. Sample App Code<a class="headerlink" href="#5.2.-Sample-App-Code" title="Permalink to this headline">¶</a></h2>
<div class="section" id="Configuration-Query-Sample-App-Code">
<h3>Configuration Query Sample App Code<a class="headerlink" href="#Configuration-Query-Sample-App-Code" title="Permalink to this headline">¶</a></h3>
<p>Below is a sample query showing how an application would make a query through the Configuration File API to change all loads to constant current loads, convert the power system model to a set of OpenDSS files, and export them to the directory <code class="docutils literal notranslate"><span class="pre">/tmp/dsssimulation</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">topic</span> <span class="o">=</span> <span class="s2">&quot;goss.gridappsd.process.request.config&quot;</span>

<span class="n">message</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;configurationType&quot;</span><span class="p">:</span> <span class="s2">&quot;DSS All&quot;</span><span class="p">,</span>
    <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;directory&quot;</span><span class="p">:</span> <span class="s2">&quot;/tmp/dsssimulation/&quot;</span><span class="p">,</span>
        <span class="s2">&quot;model_id&quot;</span><span class="p">:</span> <span class="n">model_mrid</span><span class="p">,</span>
        <span class="s2">&quot;simulation_id&quot;</span><span class="p">:</span> <span class="s2">&quot;12345678&quot;</span><span class="p">,</span>
        <span class="s2">&quot;simulation_name&quot;</span><span class="p">:</span> <span class="s2">&quot;ieee13&quot;</span><span class="p">,</span>
        <span class="s2">&quot;simulation_start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;1518958800&quot;</span><span class="p">,</span>
        <span class="s2">&quot;simulation_duration&quot;</span><span class="p">:</span> <span class="s2">&quot;60&quot;</span><span class="p">,</span>
        <span class="s2">&quot;simulation_broker_host&quot;</span><span class="p">:</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
        <span class="s2">&quot;simulation_broker_port&quot;</span><span class="p">:</span> <span class="s2">&quot;61616&quot;</span><span class="p">,</span>
        <span class="s2">&quot;schedule_name&quot;</span><span class="p">:</span> <span class="s2">&quot;ieeezipload&quot;</span><span class="p">,</span>
        <span class="s2">&quot;load_scaling_factor&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;z_fraction&quot;</span><span class="p">:</span> <span class="s2">&quot;0.0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;i_fraction&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;p_fraction&quot;</span><span class="p">:</span> <span class="s2">&quot;0.0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;solver_method&quot;</span><span class="p">:</span> <span class="s2">&quot;NR&quot;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="n">gapps</span><span class="o">.</span><span class="n">get_response</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
</div>
</div>
<div class="section" id="Processing-Measurements-&amp;-App-Core-Algorithm">
<h2>Processing Measurements &amp; App Core Algorithm<a class="headerlink" href="#Processing-Measurements-&-App-Core-Algorithm" title="Permalink to this headline">¶</a></h2>
<p>The next portion of a GridAPPS-D application is the measurement processing and core algorithm section. This section is built as either a class or function definition with prescribed arguments. Each has its advantages and disadvantages:</p>
<ul class="simple">
<li><p>The function-based approach is simpler and easier to implement. However, any parameters obtained from other APIs or methods to be used inside the function currently need to be defined as global variables.</p></li>
<li><p>The class-based approach is more complex, but also more powerful. It provides greater flexibility in creating additional methods, arguments, etc.</p></li>
</ul>
</div>
<div class="section" id="6.1-Information-Flow">
<h2>6.1 Information Flow<a class="headerlink" href="#6.1-Information-Flow" title="Permalink to this headline">¶</a></h2>
<div class="section" id="App-Core-Information-Flow">
<h3>App Core Information Flow<a class="headerlink" href="#App-Core-Information-Flow" title="Permalink to this headline">¶</a></h3>
<p>This portion of the application does not communicate directly with the GridAPPS-D platform.</p>
<p>Instead, the next part of the GridAPPS-D application (<a class="reference external" href="#7.-Subscribing-to-Simulation-Output">Subscribing to Simulation Output</a>) delivers the simulated SCADA measurement data to the core algorithm function / class definition. The core algorithm processes the data to extract the desired measurements and run its optimization / control agorithm.</p>
<p><img alt="app-core-algorithm" src="../_images/05_app_core_algorithm.png" /></p>
<p><strong>No message from core algorithm to GridAPPS-D Platform</strong></p>
<p>The core algorithm does not send any API messages to the platform</p>
<p><strong>No response to core algorithm from GridAPPS-D Platform</strong></p>
<p>The core algorithm receives its measurement data and other imputs from the subscription object defined next, rather than directly from the GridAPPS-D platform.</p>
</div>
<div class="section" id="6.2.-Sample-App-Code">
<h3>6.2. Sample App Code<a class="headerlink" href="#6.2.-Sample-App-Code" title="Permalink to this headline">¶</a></h3>
<p>Below is a very simple core algorithm that determines the number of open switches in the model and prints the result for each simulation timestep. The syntax of the function / class definition is described in detail in</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">demoSubscription1</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="c1"># Extract time and measurement values from message</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">][</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span>
    <span class="n">meas_value</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">][</span><span class="s2">&quot;measurements&quot;</span><span class="p">]</span>

    <span class="n">meas_mrid</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">meas_value</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="c1">#obtain list of all mrid from message</span>

    <span class="c1"># Filter to measurements with value of zero</span>
    <span class="n">open_switches</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">Pos_obj</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">index</span><span class="p">[</span><span class="s2">&quot;measid&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">meas_value</span><span class="p">:</span>
            <span class="n">mrid</span> <span class="o">=</span> <span class="n">index</span><span class="p">[</span><span class="s2">&quot;measid&quot;</span><span class="p">]</span>
            <span class="n">power</span> <span class="o">=</span> <span class="n">meas_value</span><span class="p">[</span><span class="n">mrid</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">power</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">open_switches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">[</span><span class="s2">&quot;eqname&quot;</span><span class="p">])</span>

    <span class="c1"># Print message to command line</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;............&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of open switches at time&quot;</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="s1">&#39; is &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">open_switches</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
</div>
</div>
<div class="section" id="7.-Subscribing-to-Simulation-Output">
<h2>7. Subscribing to Simulation Output<a class="headerlink" href="#7.-Subscribing-to-Simulation-Output" title="Permalink to this headline">¶</a></h2>
<p>The next portion of a GridAPPS-D application is series of queries to the Timeseries API to obtain information about the weather data for the current time, including irradiation, temperature, etc. This information can be used for solar forecasting, load forecasting, etc.</p>
<p>Because GridAPPS-D applications are designed to be portable across numerous power system models without any code modification, the application must query the Timeseries Influx Database and create a set of local variables that contain the weather data needed by the app to run its internal code.</p>
<div class="section" id="7.1.-Information-Flow">
<h3>7.1. Information Flow<a class="headerlink" href="#7.1.-Information-Flow" title="Permalink to this headline">¶</a></h3>
<p>The figure below shows the information flow involved in subscribing to the simulation output.</p>
<p>The subscription request is sent using <code class="docutils literal notranslate"><span class="pre">gapps.subscribe(topic,</span> <span class="pre">class/function</span> <span class="pre">object)</span></code> on the specific Simulation topic channel (explained in <a class="reference internal" href="../api_usage/3.1--Lesson-3.1--API-Communication-Channels.html"><span class="doc">API Communication Channels</span></a>). No immediate response is expected back from the platform. However, after the next simulation timestep, the Platform will continue to deliver a complete set of measurements back to the application for each timestep until the end of the simulation.</p>
<p><img alt="subscribe-to-simulation" src="../_images/06_subscribe_to_sim.png" /></p>
<p><strong>Application passes subscription request to GridAPPS-D Platform</strong></p>
<p>The subscription request is perfromed by passing the app core algorithm function / class definition to the <code class="docutils literal notranslate"><span class="pre">gapps.subscribe</span></code> method. The application then passes the subscription request through the Simulation API to the topic channel for the particular simulation on the GOSS Message Bus. If the application is authorized to access simulation output, the subscription request is delivered to the Simulation Manager.</p>
<p><strong>GridAPPS-D Platform delivers published simulation output to Application</strong></p>
<p>Unlike the previous queries made to the various databases, the GridAPPS-D Platform does not provide any immediate response back to the application. Instead, the Simulation Manager will start delivering measurement data back to the application through the Simulation API at each subsequent timestep until the simulation ends or the application unsubscribes. The measurement data is then passed to the core algorithm class / function, where it is processed and used to run the app’s optimization /
control algorithms.</p>
</div>
<div class="section" id="7.2.-Sample-App-Code">
<h3>7.2. Sample App Code<a class="headerlink" href="#7.2.-Sample-App-Code" title="Permalink to this headline">¶</a></h3>
<p>Below is an example of how an application subscribes to the GridAPPS-D simulation output using the function or class definition created as part of the <a class="reference external" href="#6.-Processing-Measurements-&amp;-App-Core-Algorithm">Measurement Processing / App Core</a></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">gridappsd.topics</span> <span class="kn">import</span> <span class="n">simulation_output_topic</span>

<span class="n">output_topic</span> <span class="o">=</span> <span class="n">simulation_output_topic</span><span class="p">(</span><span class="n">viz_simulation_id</span><span class="p">)</span>

<span class="n">gapps</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">output_topic</span><span class="p">,</span> <span class="n">demoSubscription1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
</div>
</div>
<div class="section" id="8.-Publishing-Equipment-Commands">
<h2>8. Publishing Equipment Commands<a class="headerlink" href="#8.-Publishing-Equipment-Commands" title="Permalink to this headline">¶</a></h2>
<p>The next portion of a GridAPPS-D App is publsihing equipment control commands based on the optimization results or objectives of the app algorithm.</p>
<p>Depending on the preference of the developer, this portion can be a separate function definition, or included as part of the main class definition as part of the <a class="reference external" href="#6.-Processing-Measurements-&amp;-App-Core-Algorithm">Measurement Processing / App Core</a> class definition described earlier.</p>
<div class="section" id="8.1.-Information-Flow">
<h3>8.1. Information Flow<a class="headerlink" href="#8.1.-Information-Flow" title="Permalink to this headline">¶</a></h3>
<p>The figure below outlines information flow involved in publishing equipment commands to the simulation input.</p>
<p>Unlike the various queries to the databases in the app sections earlier, equipment control commands are passed to the GridAPPS-D API using the <code class="docutils literal notranslate"><span class="pre">gapps.send(topic,</span> <span class="pre">message)</span></code> method. No response is expected from the GridAPPS-D platform.</p>
<p>If the application desires to verify that the equipment control command was received and implemented, it needs to do so by 1) checking for changes in the associated measurements at the next timestep and/or 2) querying the Timeseries Database for historical simulation data associated with the equipment control command.</p>
<p><img alt="publish-commands" src="../_images/07_publish_commands.png" /></p>
<p><strong>Application sends difference message to GridAPPS-D Platform</strong></p>
<p>First, the application creates a difference message containing the current and desired future control point / state of the particular piece of power system equipment to be controlled. The difference message is a JSON string or equivalant Python dictionary object. The syntax of a difference message is explained in detail in <a class="reference internal" href="../api_usage/3.6--Lesson-3.6--Controlling-Simulation-API.html"><span class="doc">Publishing Equipment Commands</span></a>.</p>
<p>The application then passes the query through the Simulation API to the GridAPPS-D Platform, which publishes it on the topic channel for the particular simulation on the GOSS Message Bus. If the app is authenticated and authorized to control equipment, the difference message is delivered to the Simulation Manager. The Simulation Manager then passes the command to the simulation through the Co-Simulation Bridge (either FNCS or HELICS).</p>
<p><strong>No response from GridAPPS-D Platform back to Application</strong></p>
<p>The GridAPPS-D Platform does not provide any response back to the application after processing the difference message and implementing the new equipment control setpoint.</p>
</div>
<div class="section" id="8.2.-Sample-App-Code">
<h3>8.2. Sample App Code<a class="headerlink" href="#8.2.-Sample-App-Code" title="Permalink to this headline">¶</a></h3>
<p>Below is an example of an app code block</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">gridappsd</span> <span class="kn">import</span> <span class="n">DifferenceBuilder</span>
<span class="kn">from</span> <span class="nn">gridappsd.topics</span> <span class="kn">import</span> <span class="n">simulation_input_topic</span>

<span class="n">input_topic</span> <span class="o">=</span> <span class="n">simulation_input_topic</span><span class="p">(</span><span class="n">viz_simulation_id</span><span class="p">)</span>

<span class="n">my_open_diff</span> <span class="o">=</span> <span class="n">DifferenceBuilder</span><span class="p">(</span><span class="n">viz_simulation_id</span><span class="p">)</span>
<span class="n">my_open_diff</span><span class="o">.</span><span class="n">add_difference</span><span class="p">(</span><span class="n">sw_mrid</span><span class="p">,</span> <span class="s2">&quot;Switch.open&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># Open switch given by sw_mrid</span>
<span class="n">open_message</span> <span class="o">=</span> <span class="n">my_open_diff</span><span class="o">.</span><span class="n">get_message</span><span class="p">()</span>

<span class="n">my_close_diff</span> <span class="o">=</span> <span class="n">DifferenceBuilder</span><span class="p">(</span><span class="n">viz_simulation_id</span><span class="p">)</span>
<span class="n">my_close_diff</span><span class="o">.</span><span class="n">add_difference</span><span class="p">(</span><span class="n">sw_mrid</span><span class="p">,</span> <span class="s2">&quot;Switch.open&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># Close switch given by sw_mrid</span>
<span class="n">close_message</span> <span class="o">=</span> <span class="n">my_close_diff</span><span class="o">.</span><span class="n">get_message</span><span class="p">()</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">gapps</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">input_topic</span><span class="p">,</span> <span class="n">open_message</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">gapps</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">input_topic</span><span class="p">,</span> <span class="n">close_message</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="8.3.-Viewing-Application-Results-in-GridAPPS-D-Viz">
<h3>8.3. Viewing Application Results in GridAPPS-D Viz<a class="headerlink" href="#8.3.-Viewing-Application-Results-in-GridAPPS-D-Viz" title="Permalink to this headline">¶</a></h3>
<p>Return to the browser tab in which the GridAPPS-D Simulation is currently running. Switch <code class="docutils literal notranslate"><span class="pre">sw5</span></code> will now be opening and closing every 5 seconds, with the downstream portion of the feeder being de-energized and reconnected with each switch operation.</p>
<p>The core application algorithm will also reflect this with the printed response alternating between two and three open switches every few timesteps.</p>
<hr class="docutils" />
</div>
</div>
<div class="section" id="9.-Querying-Historical-&amp;-Timeseries-Data">
<h2>9. Querying Historical &amp; Timeseries Data<a class="headerlink" href="#9.-Querying-Historical-&-Timeseries-Data" title="Permalink to this headline">¶</a></h2>
<p>The next portion of a GridAPPS-D application is querying historical data from the current and/or previous simulations.</p>
<p>All simulation output and commands from the current and previous simulations are stored in the Timeseries Database, and can be queried to provide AI/ML training data, verify processing of equipment commands, or</p>
<p>Note that Timeseries Database data is cleared when the GridAPPS-D Platform is shut down with the ./stop.sh script. It is recommended to copy historical / training data to an external persistent directory using the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">cp</span></code> command, as given in <a class="reference internal" href="../installation/1.6--Lesson-1.6--Docker-Shortcuts.html"><span class="doc">Docker Shortcuts</span></a>.</p>
<div class="section" id="9.1.-Information-Flow">
<h3>9.1. Information Flow<a class="headerlink" href="#9.1.-Information-Flow" title="Permalink to this headline">¶</a></h3>
<p>The figure below outlines the information flow involved in querying for historical and timeseries data.</p>
<p>The query is sent using the <code class="docutils literal notranslate"><span class="pre">gapps.get_response(topic,</span> <span class="pre">message)</span></code> method on the Timeseries queue channel with a response expected back from the GridAPPS-D platform within the specified timeout period.</p>
<p><img alt="query-timeseries-data" src="../_images/08_query_timeseries.png" /></p>
<p><strong>Application passes query to GridAPPS-D Platform</strong></p>
<p>First, the application creates a query message for requesting information about the desired power system components in the format of a JSON string or equivalant Python dictionary object. The syntax of this message is explained in detail in <a class="reference internal" href="../api_usage/3.7--Lesson-3.7--Using-the-Timeseries-API.html"><span class="doc">Querying Timeseries Data</span></a>.</p>
<p>The application then passes the query through the Timeseries API to the GridAPPS-D Platform, which publishes it to a queue channel on the GOSS Message Bus. If the app is authenticated and authorized to pass queries, the query message is delivered to the Data Managers, which obtain the desired information from the Timeseries Influx Database.</p>
<p><strong>GridAPPS-D Platform responds to Application query</strong></p>
<p>The Data Managers then publish the response from the Timeseries Influx Database to the appropriate queue channel. The Timeseries API then returns the desired information back to the application as a JSON message or equivalant Python dictionary object.</p>
</div>
<div class="section" id="9.2.-Sample-App-Code">
<h3>9.2. Sample App Code<a class="headerlink" href="#9.2.-Sample-App-Code" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">time</span>

<span class="n">start_time</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># Start query from 10 sec ago</span>
<span class="n">end_time</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()))</span>

<span class="c1"># Query for a particular set of measurments</span>
<span class="n">message</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;queryMeasurement&quot;</span><span class="p">:</span> <span class="s2">&quot;simulation&quot;</span><span class="p">,</span>
    <span class="s2">&quot;queryFilter&quot;</span><span class="p">:{</span><span class="s2">&quot;simulation_id&quot;</span><span class="p">:</span> <span class="n">simulation_id</span><span class="p">,</span>
                   <span class="s2">&quot;startTime&quot;</span><span class="p">:</span> <span class="n">start_time</span><span class="p">,</span>
                   <span class="s2">&quot;endTime&quot;</span><span class="p">:</span> <span class="n">end_time</span><span class="p">,</span>
                   <span class="s2">&quot;measurement_mrid&quot;</span><span class="p">:</span> <span class="n">pos_obj</span><span class="p">},</span>
    <span class="s2">&quot;responseFormat&quot;</span><span class="p">:</span><span class="s2">&quot;JSON&quot;</span>
<span class="p">}</span>

<span class="n">gapps</span><span class="o">.</span><span class="n">get_response</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">TIMESERIES</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span> <span class="c1"># Pass API call</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
</div>
</div>
<div class="section" id="10.-Subscribing-and-Publishing-to-Logs">
<h2>10. Subscribing and Publishing to Logs<a class="headerlink" href="#10.-Subscribing-and-Publishing-to-Logs" title="Permalink to this headline">¶</a></h2>
<p>The last portion of an application is subscribing and publishing to logs. This step is extremely useful for 1) informing end users of application behavior and 2) application debugging during development and demonstration.</p>
<p>The The GridAPPS-D Logging API provides an extension of the standard Python logging library and enables applications to subscribe to real-time log messages from a simulation, query previously logged messages from the MySQL database, and publish messages to their either own log or their GridAPPS-D logs.</p>
<div class="section" id="10.1.-Information-Flow-Diagram">
<h3>10.1. Information Flow Diagram<a class="headerlink" href="#10.1.-Information-Flow-Diagram" title="Permalink to this headline">¶</a></h3>
<p>The figure below shows the information flow involved in subscribing and publishing to logs.</p>
<p><img alt="subscribe-publish-to-logs" src="../_images/09_subscribe_publish_logs.png" /></p>
</div>
<div class="section" id="10.2-Sample-App-Code">
<h3>10.2 Sample App Code<a class="headerlink" href="#10.2-Sample-App-Code" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">gridappsd.topics</span> <span class="kn">import</span> <span class="n">simulation_log_topic</span>
<span class="n">log_topic</span> <span class="o">=</span> <span class="n">simulation_log_topic</span><span class="p">(</span><span class="n">viz_simulation_id</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">demoLogFunction</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span>
    <span class="n">log_message</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="s2">&quot;logMessage&quot;</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Log message received at timestamp &quot;</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="s2">&quot;which reads:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">log_message</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;........................&quot;</span><span class="p">)</span>

<span class="n">gapps</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">log_topic</span><span class="p">,</span> <span class="n">demoLogFunction</span><span class="p">)</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
<p><img alt="gridappsd-logo" src="../_images/GridAPPS-D_narrow.png" /></p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="2.5--Lesson-2.5--GridAPPS-D-Service-Structure.html" class="btn btn-neutral float-right" title="GridAPPS-D Service Structure" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="2.3--Lesson-2.3--GridAPPS-D-Python-Library.html" class="btn btn-neutral float-left" title="GridAPPS-D Python Library" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2017-2021, Battelle Memorial Institute, All rights reserved..

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>